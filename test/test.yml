---
- name: test mov
  reset: false
  state:
    registers:
      a: 0
      b: 5
      c: 0
      d: 0
      e: 0
      h: 0
      l: 0
    memory:
      - location: 100
        data: [0, 0, 0, 0]
  code:
    - mov b,b
    - mov c,b
    - mov d,b
    - mov e,b
    - mov h,b
    - mov l,b
    - mov a,b
    - mov m,b
  expected:
    registers:
      a: 5
      b: 5
      c: 5
      d: 5
      e: 5
      h: 5
      l: 5
    memory:
      - location: 1285
        data: [5]
- name: test mvi
  code:
    - mvi b,1
    - mvi c,2
    - mvi d,3
    - mvi e,4
    - mvi h,5
    - mvi l,6
    - mvi m,7
    - mvi a,8
  expected:
    registers:
      a: 8
      b: 1
      c: 2
      d: 3
      e: 4
      h: 5
      l: 6
    memory:
      - location: 1286
        data: [7]
- name: test lxi
  code:
    - lxi bc, 258
    - lxi de, 772
    - lxi hl, 1286
    - lxi sp, 1800
  expected:
    registers:
      b: 1
      c: 2
      d: 3
      e: 4
      h: 5
      l: 6
      sp: 1800
- name: test lda
  state:
    memory:
      - location: 100
        data: [20]
  code:
    - lda 100
  expected:
    registers:
      a: 20
- name: test sta
  code:
    - mvi a, 25
    - sta 100
  expected:
    memory:
      - location: 100
        data: [25]
- name: test lhld
  state:
    memory:
      - location: 100
        data: [1, 2]
  code:
    - lhld 100
  expected:
    registers:
      l: 1
      h: 2

- name: test shld
  state:
    memory:
      - location: 100
        data: [1, 0]
  code:
    - lxi hl, 256
    - shld 100
  expected:
    memory:
      - location: 100
        data: [0, 1]
- name: test ldax bc
  state:
    memory:
      - location: 100
        data: [25, 1]
  code:
    - lxi bc, 100
    - ldax bc
  expected:
    registers:
      a: 25
- name: test ldax de
  state:
    memory:
      - location: 100
        data: [25, 1]
  code:
    - lxi de, 100
    - ldax de
  expected:
    registers:
      a: 25
- name: test stax bc
  state:
    memory:
      - location: 100
        data: [0, 2]
  code:
    - mvi a, 23
    - lxi bc, 100
    - stax bc
  expected:
    memory:
      - location: 100
        data: [23, 2]
- name: test stax de
  state:
    memory:
      - location: 100
        data: [0, 2]
  code:
    - mvi a, 25
    - lxi de, 100
    - stax de
  expected:
    memory:
      - location: 100
        data: [25, 2]
- name: test xchg
  code:
    - lxi de,513
    - lxi hl,1027
    - xchg
  expected:
    registers:
      d: 4
      e: 3
      h: 2
      l: 1
- name: test add minus
  code:
    - mvi a,5
    - mvi b,128
    - add b
  expected:
    registers:
      a: 133
    flags:
      z: 0
      s: 1
      c: 0
      p: 0
      a: 0

- name: test add and cary
  code:
    - mvi a,5
    - mvi b,255
    - add b
  expected:
    registers:
      a: 4
    flags:
      z: 0
      s: 0
      c: 1
      p: 0
      a: 1
- name: test add and zero
  code:
    - mvi a,1
    - mvi b,255
    - add b
  expected:
    registers:
      a: 0
    flags:
      z: 1
      s: 0
      c: 1
      p: 1
      a: 1
- name: test adi
  code:
    - mvi a,0
    - adi 15
  expected:
    registers:
      a: 15
    flags:
      z: 0
      s: 0
      c: 0
      p: 1
      a: 0
- name: test adi carry flag
  code:
    - mvi a,255
    - adi 1
  expected:
    registers:
      a: 0
    flags:
      z: 1
      s: 0
      c: 1
      p: 1
      a: 1
- name: test adi carry flag and non zero
  code:
    - mvi a,255
    - adi 2
  expected:
    registers:
      a: 1
    flags:
      z: 0
      s: 0
      c: 1
      p: 0
      a: 1
- name: test adc with carry flag
  state:
    flags:
      c: 1
      z: 0
  code:
    - mvi a,0
    - mvi b,1
    - adc b
  expected:
    registers:
      a: 2
    flags:
      z: 0
      s: 0
      c: 0
      p: 0
      a: 0
- name: test adc with carry flag off
  state:
    flags:
      c: 0
      z: 0
  code:
    - mvi a,0
    - aci 3
  expected:
    registers:
      a: 3
    flags:
      z: 0
      s: 0
      c: 0
      p: 1
      a: 0
# - name: test sub
#   code:
#     - mvi a,1
#     - mvi b,255
#     - sub b
#   expected:
#     registers:
#       a: 2
#     flags:
#       z: 0
#       s: 0
#       c: 0
#       p: 1
#       a: 0
- name: test inr
  code:
    - mvi a, 1
    - inr a
  expected:
    registers:
      a: 2
    flags:
      z: 0
      s: 0
      p: 0
      a: 0
- name: test inr with ac flags
  code:
    - mvi a, 15
    - inr a
  expected:
    registers:
      a: 16
    flags:
      z: 0
      s: 0
      p: 0
      a: 1
- name: test inr with s flags
  code:
    - mvi a, 127
    - inr a
  expected:
    registers:
      a: 128
    flags:
      z: 0
      s: 1
      p: 0
      a: 1
- name: test inr memory
  state:
    registers:
      h: 0
      l: 100

    memory:
      - location: 100
        data: [6]
  code:
    - lxi hl,100
    - inr m
  expected:
    registers:
      h: 0
      l: 100
    memory:
      - location: 100
        data: [7]
    flags:
      z: 0
      s: 0
      p: 0
- name: test dec with ac flags
  code:
    - mvi a, 16
    - dcr a
  expected:
    registers:
      a: 15
    flags:
      z: 0
      s: 0
      p: 1
      a: 1
- name: test inx
  state:
    registers:
      b: 1
      c: 255
  code:
    - inx bc
  expected:
    registers:
      b: 2
      c: 0
- name: test dcx
  state:
    registers:
      b: 2
      c: 0
  code:
    - dcx bc
  expected:
    registers:
      b: 1
      c: 255
- name: test ana b
  code:
    - mvi a, 7
    - mvi b, 3
    - ana b
  expected:
    registers:
      a: 3
    flags:
      z: 0
      s: 0
      p: 1
- name: test sub

  code:
    - mvi a,4
    - sui 5
  expected:
    registers:
      a: 255
    flags:
      c: 1
      p: 1
      z: 0

- name: test sub

  code:
    - mvi a,5
    - sui 4
  expected:
    registers:
      a: 1
    flags:
      c: 0
      p: 0
      z: 0

- name: test sub

  code:
    - mvi a,128
    - sui 5
  expected:
    registers:
      a: 123
    flags:
      c: 0

- name: test sbi
  state:
    flags:
      c: 1
  code:
    - mvi a,5
    - sbi 4
  expected:
    registers:
      a: 0
    flags:
      c: 0
      p: 1
      z: 1
- name: array sum
  state:
    memory:
      - location: 12
        data : [0x10 ,0x20 ,0x30 ,0x10 ,0x20]
  code:
    - mvi d, 0
    - lxi bc, 12
    - ldax bc
    - cpi 0
    - jz 11
    - add d
    - mov d,a
    - inr c
    - jmp 5  
  expected:
    d: 144  